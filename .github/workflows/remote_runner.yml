name: MISTAKE619 Private Stealth Engine
on:
  push:
    paths-ignore:
      - '.github/**'
      - 'README.md'

jobs:
  stealth_process:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Media Tools
        run: sudo apt-get update && sudo apt-get install -y ffmpeg imagemagick

      - name: Process & Absolute Privacy Cleanup
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action [Bot]"

          # Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ù‡Ø± Ù†ÙˆØ¹ ÙØ§ÛŒÙ„ Ø§Ø±Ø³Ø§Ù„ÛŒ
          FILES=$(git diff --name-only HEAD^ HEAD | grep -E '\.(jpg|jpeg|png|mp4|mov|avi)$' || true)
          
          for FILE in $FILES; do
            if [ -f "$FILE" ]; then
              EXTENSION="${FILE##*.}"
              OUT_FILE="ENHANCED_${FILE}"

              # Ø§ÙØ²Ø§ÛŒØ´ Ú©ÛŒÙÛŒØª Ø®ÙˆØ¯Ú©Ø§Ø±
              if [[ "$EXTENSION" =~ ^(jpg|jpeg|png)$ ]]; then
                convert "$FILE" -auto-level -unsharp 0x1 -quality 100 "$OUT_FILE"
              elif [[ "$EXTENSION" =~ ^(mp4|mov|avi)$ ]]; then
                ffmpeg -i "$FILE" -vcodec libx264 -crf 18 -preset slow -acodec copy "$OUT_FILE"
              fi

              # Ø­Ø°Ù Ú©Ø§Ù…Ù„ ÙØ§ÛŒÙ„ Ø§ØµÙ„ÛŒ Ø¨Ø±Ø§ÛŒ Ø­ÙØ¸ Ø­Ø±ÛŒÙ… Ø®ØµÙˆØµÛŒ
              git rm "$FILE"
              git add "$OUT_FILE"
            fi
          done

          # Ø¨Ø®Ø´ Ø´Ø§Ù‡Ú©Ø§Ø±: Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ú©Ø§Ù…ÛŒØªâ€ŒÙ‡Ø§ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ Ø§Ù…Ø§ ØªÙˆØµÛŒÙ‡ Ø´Ø¯Ù‡)
          # Ø§ÛŒÙ† Ú©Ø§Ø± Ø¨Ø§Ø¹Ø« Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ù‡Ù…ÛŒØ´Ù‡ ÙÙ‚Ø· Û± Ú©Ø§Ù…ÛŒØª Ø¯Ø± Ú¯ÛŒØªâ€ŒÙ‡Ø§Ø¨ Ø¯ÛŒØ¯Ù‡ Ø´ÙˆØ¯
          git commit --amend -m "ğŸ”’ Secure Session: $(date +'%Y-%m-%d %H:%M')" || git commit -m "ğŸ”’ Secure Session"
          git push origin main --force

