name: MISTAKE619 Private Stealth Engine
on:
  push:
    # Ø¨Ø§ Ù‡Ø± ØªØºÛŒÛŒØ±ÛŒ Ø¯Ø± Ù…Ø®Ø²Ù†ØŒ Ø³ÛŒØ³ØªÙ… Ø¨Ù‡ Ø·ÙˆØ± Ù‡ÙˆØ´Ù…Ù†Ø¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø±Ø§ Ø´Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯
    paths-ignore:
      - '.github/**'
      - 'README.md'
      - 'result.log'

jobs:
  stealth_process:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Media Tools
        run: |
          sudo apt-get update
          sudo apt-get install -y ffmpeg imagemagick

      - name: Dynamic Processing & Privacy Cleanup
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action [Bot]"

          # Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ù‡Ø± Ù†ÙˆØ¹ ÙØ§ÛŒÙ„ Ø¹Ú©Ø³ ÛŒØ§ ÙˆÛŒØ¯ÛŒÙˆ Ø¨Ø§ Ù‡Ø± Ù†Ø§Ù…ÛŒ
          FILES=$(git diff --name-only HEAD^ HEAD | grep -E '\.(jpg|jpeg|png|mp4|mov|avi)$' || true)
          
          for FILE in $FILES; do
            if [ -f "$FILE" ]; then
              echo "Processing: $FILE"
              EXTENSION="${FILE##*.}"
              FILENAME="${FILE%.*}"
              OUT_FILE="ENHANCED_${FILENAME}.${EXTENSION}"

              # Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÙˆØ¹ ÙØ§ÛŒÙ„
              if [[ "$EXTENSION" =~ ^(jpg|jpeg|png)$ ]]; then
                convert "$FILE" -auto-level -unsharp 0x1 -quality 100 "$OUT_FILE"
              elif [[ "$EXTENSION" =~ ^(mp4|mov|avi)$ ]]; then
                ffmpeg -i "$FILE" -vcodec libx264 -crf 18 -preset slow -acodec copy "$OUT_FILE"
              fi

              # Ø¨Ø®Ø´ Ø­Ø±ÛŒÙ… Ø®ØµÙˆØµÛŒ: Ø­Ø°Ù ÙØ§ÛŒÙ„ Ø§ØµÙ„ÛŒ Ø§Ø² Ù…Ø®Ø²Ù†
              git rm "$FILE"
              # Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ÙØ§ÛŒÙ„ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø´Ø¯Ù‡
              git add "$OUT_FILE"
            fi
          done

          # Ø§Ø±Ø³Ø§Ù„ ØªØºÛŒÛŒØ±Ø§Øª (Ø­Ø°Ù ÙˆØ±ÙˆØ¯ÛŒ Ùˆ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†ÛŒ Ø¨Ø§ Ø®Ø±ÙˆØ¬ÛŒ)
          git commit -m "ğŸ”’ Private Session: Processed & Original Deleted" || echo "No files to process"
          git push origin main

      - name: Upload as Secret Artifact
        # Ø§ÛŒÙ† Ø¨Ø®Ø´ ÛŒÚ© Ù†Ø³Ø®Ù‡ Ø¯Ø± Ø¨Ø®Ø´ Actions Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ú©Ù‡ Ø¹Ù…ÙˆÙ…ÛŒ Ù†ÛŒØ³Øª
        uses: actions/upload-artifact@v4
        with:
          name: private-enhanced-output
          path: ENHANCED_*
          retention-days: 1

